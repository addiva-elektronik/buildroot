From c2eadad922b57bb4dd2c6281fc912d503f9c6c5d Mon Sep 17 00:00:00 2001
From: Tobias Waldekranz <tobias@waldekranz.com>
Date: Wed, 20 Nov 2024 12:43:06 +0100
Subject: [PATCH 1/2] lib: Update libyang log callback to match new version
Organization: Addiva Elektronik

Signed-off-by: Tobias Waldekranz <tobias@waldekranz.com>
---
 lib/yang.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/lib/yang.c b/lib/yang.c
index 4dd865421..e67ccf67a 100644
--- a/lib/yang.c
+++ b/lib/yang.c
@@ -657,7 +657,9 @@ struct yang_data *yang_data_list_find(const struct list *list,
 }
 
 /* Make libyang log its errors using FRR logging infrastructure. */
-static void ly_log_cb(LY_LOG_LEVEL level, const char *msg, const char *path)
+static void ly_log_cb(LY_LOG_LEVEL level, const char *msg,
+		      const char *data_path, const char *schema_path,
+		      uint64_t line)
 {
 	int priority = LOG_ERR;
 
@@ -674,8 +676,8 @@ static void ly_log_cb(LY_LOG_LEVEL level, const char *msg, const char *path)
 		break;
 	}
 
-	if (path)
-		zlog(priority, "libyang: %s (%s)", msg, path);
+	if (data_path)
+		zlog(priority, "libyang: %s (%s)", msg, data_path);
 	else
 		zlog(priority, "libyang: %s", msg);
 }
@@ -752,7 +754,7 @@ struct ly_ctx *yang_ctx_new_setup(bool embedded_modules, bool explicit_compile)
 void yang_init(bool embedded_modules, bool defer_compile)
 {
 	/* Initialize libyang global parameters that affect all containers. */
-	ly_set_log_clb(ly_log_cb, 1);
+	ly_set_log_clb(ly_log_cb);
 	ly_log_options(LY_LOLOG | LY_LOSTORE);
 
 	/* Initialize libyang container for native models. */
-- 
2.43.0

